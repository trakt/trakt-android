<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/app/src/main/java/tv/trakt/trakt/core/profile/ProfileViewModel.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/tv/trakt/trakt/core/profile/ProfileViewModel.kt" />
              <option name="originalContent" value="package tv.trakt.trakt.core.profile&#10;&#10;import androidx.datastore.core.DataStore&#10;import androidx.datastore.preferences.core.Preferences&#10;import androidx.datastore.preferences.core.edit&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.google.firebase.Firebase&#10;import com.google.firebase.remoteconfig.remoteConfig&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.SharingStarted&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.combine&#10;import kotlinx.coroutines.flow.stateIn&#10;import kotlinx.coroutines.flow.update&#10;import kotlinx.coroutines.launch&#10;import timber.log.Timber&#10;import tv.trakt.trakt.common.auth.session.SessionManager&#10;import tv.trakt.trakt.common.helpers.LoadingState&#10;import tv.trakt.trakt.common.helpers.LoadingState.LOADING&#10;import tv.trakt.trakt.common.helpers.extensions.rethrowCancellation&#10;import tv.trakt.trakt.core.auth.usecase.AuthorizeUserUseCase&#10;import tv.trakt.trakt.core.auth.usecase.authCodeKey&#10;import tv.trakt.trakt.core.profile.usecase.GetUserProfileUseCase&#10;import tv.trakt.trakt.core.profile.usecase.LogoutUserUseCase&#10;&#10;internal class ProfileViewModel(&#10;    private val sessionManager: SessionManager,&#10;    private val authorizePreferences: DataStore&lt;Preferences&gt;,&#10;    private val authorizeUseCase: AuthorizeUserUseCase,&#10;    private val getProfileUseCase: GetUserProfileUseCase,&#10;    private val logoutUseCase: LogoutUserUseCase,&#10;) : ViewModel() {&#10;    private val initialState = ProfileState()&#10;&#10;    private val backgroundState = MutableStateFlow(initialState.backgroundUrl)&#10;    private val loadingState = MutableStateFlow(initialState.loading)&#10;    private val signedInState = MutableStateFlow(initialState.isSignedIn)&#10;&#10;    init {&#10;        loadBackground()&#10;        observeProfile()&#10;        observeAuthCode()&#10;    }&#10;&#10;    private fun observeAuthCode() {&#10;        viewModelScope.launch {&#10;            authorizePreferences.data.collect { preferences -&gt;&#10;                preferences[authCodeKey]?.let { code -&gt;&#10;                    authorizePreferences.edit { it.remove(authCodeKey) }&#10;                    authorizeUser(code)&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun observeProfile() {&#10;        viewModelScope.launch {&#10;            sessionManager.observeProfile()&#10;                .collect { profile -&gt;&#10;                    val isSignedOut = (profile == null)&#10;//                        &amp;&amp; profileState.value != null&#10;//                    profileState.update { profile }&#10;                    signedInState.update { !isSignedOut }&#10;                }&#10;        }&#10;    }&#10;&#10;    private fun loadBackground() {&#10;        val configUrl = Firebase.remoteConfig.getString(&quot;mobile_background_image_url&quot;)&#10;        backgroundState.update { configUrl }&#10;    }&#10;&#10;    private fun authorizeUser(code: String) {&#10;        viewModelScope.launch {&#10;            try {&#10;                loadingState.update { LOADING }&#10;&#10;                authorizeUseCase.authorizeByCode(code)&#10;                getProfileUseCase.loadUserProfile()&#10;            } catch (error: Exception) {&#10;                error.rethrowCancellation {&#10;                    Timber.e(error)&#10;                }&#10;            } finally {&#10;                loadingState.update { LoadingState.IDLE }&#10;            }&#10;        }&#10;    }&#10;&#10;    fun logoutUser() {&#10;        viewModelScope.launch {&#10;            try {&#10;                logoutUseCase.logoutUser()&#10;            } catch (error: Exception) {&#10;                error.rethrowCancellation {&#10;                    Timber.e(error)&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    val state: StateFlow&lt;ProfileState&gt; = combine(&#10;        backgroundState,&#10;        loadingState,&#10;        signedInState,&#10;    ) { s1, s2, s3 -&gt;&#10;        ProfileState(&#10;            backgroundUrl = s1,&#10;            loading = s2,&#10;            isSignedIn = s3,&#10;        )&#10;    }.stateIn(&#10;        scope = viewModelScope,&#10;        started = SharingStarted.WhileSubscribed(5_000),&#10;        initialValue = initialState,&#10;    )&#10;}&#10;" />
              <option name="updatedContent" value="package tv.trakt.trakt.core.profile&#10;&#10;import androidx.datastore.core.DataStore&#10;import androidx.datastore.preferences.core.Preferences&#10;import androidx.datastore.preferences.core.edit&#10;import androidx.lifecycle.ViewModel&#10;import androidx.lifecycle.viewModelScope&#10;import com.google.firebase.Firebase&#10;import com.google.firebase.remoteconfig.remoteConfig&#10;import kotlinx.coroutines.flow.MutableStateFlow&#10;import kotlinx.coroutines.flow.SharingStarted&#10;import kotlinx.coroutines.flow.StateFlow&#10;import kotlinx.coroutines.flow.combine&#10;import kotlinx.coroutines.flow.stateIn&#10;import kotlinx.coroutines.flow.update&#10;import kotlinx.coroutines.launch&#10;import timber.log.Timber&#10;import tv.trakt.trakt.common.auth.session.SessionManager&#10;import tv.trakt.trakt.common.helpers.LoadingState&#10;import tv.trakt.trakt.common.helpers.LoadingState.LOADING&#10;import tv.trakt.trakt.common.helpers.extensions.rethrowCancellation&#10;import tv.trakt.trakt.core.auth.usecase.AuthorizeUserUseCase&#10;import tv.trakt.trakt.core.auth.usecase.authCodeKey&#10;import tv.trakt.trakt.core.profile.usecase.GetUserProfileUseCase&#10;import tv.trakt.trakt.core.profile.usecase.LogoutUserUseCase&#10;&#10;internal class ProfileViewModel(&#10;    private val sessionManager: SessionManager,&#10;    private val authorizePreferences: DataStore&lt;Preferences&gt;,&#10;    private val authorizeUseCase: AuthorizeUserUseCase,&#10;    private val getProfileUseCase: GetUserProfileUseCase,&#10;    private val logoutUseCase: LogoutUserUseCase,&#10;) : ViewModel() {&#10;    private val initialState = ProfileState()&#10;&#10;    private val backgroundState = MutableStateFlow(initialState.backgroundUrl)&#10;    private val loadingState = MutableStateFlow(initialState.loading)&#10;    private val profileState = MutableStateFlow(initialState.profile)&#10;    private val signedInState = MutableStateFlow(initialState.isSignedIn)&#10;&#10;    init {&#10;        loadBackground()&#10;        observeProfile()&#10;        observeAuthCode()&#10;    }&#10;&#10;    private fun observeAuthCode() {&#10;        viewModelScope.launch {&#10;            authorizePreferences.data.collect { preferences -&gt;&#10;                preferences[authCodeKey]?.let { code -&gt;&#10;                    authorizePreferences.edit { it.remove(authCodeKey) }&#10;                    authorizeUser(code)&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    private fun observeProfile() {&#10;        viewModelScope.launch {&#10;            sessionManager.observeProfile()&#10;                .collect { profile -&gt;&#10;                    val isSignedOut = (profile == null)&#10;                    profileState.update { profile }&#10;                    signedInState.update { !isSignedOut }&#10;                }&#10;        }&#10;    }&#10;&#10;    private fun loadBackground() {&#10;        val configUrl = Firebase.remoteConfig.getString(&quot;mobile_background_image_url&quot;)&#10;        backgroundState.update { configUrl }&#10;    }&#10;&#10;    private fun authorizeUser(code: String) {&#10;        viewModelScope.launch {&#10;            try {&#10;                loadingState.update { LOADING }&#10;&#10;                authorizeUseCase.authorizeByCode(code)&#10;                getProfileUseCase.loadUserProfile()&#10;            } catch (error: Exception) {&#10;                error.rethrowCancellation {&#10;                    Timber.e(error)&#10;                }&#10;            } finally {&#10;                loadingState.update { LoadingState.IDLE }&#10;            }&#10;        }&#10;    }&#10;&#10;    fun logoutUser() {&#10;        viewModelScope.launch {&#10;            try {&#10;                logoutUseCase.logoutUser()&#10;            } catch (error: Exception) {&#10;                error.rethrowCancellation {&#10;                    Timber.e(error)&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    val state: StateFlow&lt;ProfileState&gt; = combine(&#10;        backgroundState,&#10;        loadingState,&#10;        profileState,&#10;        signedInState,&#10;    ) { s1, s2, s3, s4 -&gt;&#10;        ProfileState(&#10;            backgroundUrl = s1,&#10;            loading = s2,&#10;            profile = s3,&#10;            isSignedIn = s4,&#10;        )&#10;    }.stateIn(&#10;        scope = viewModelScope,&#10;        started = SharingStarted.WhileSubscribed(5_000),&#10;        initialValue = initialState,&#10;    )&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/tv/src/main/res/drawable/ic_plus.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/tv/src/main/res/drawable/ic_plus.xml" />
              <option name="originalContent" value="&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:width=&quot;24dp&quot;&#10;    android:height=&quot;24dp&quot;&#10;    android:viewportWidth=&quot;24&quot;&#10;    android:viewportHeight=&quot;24&quot;&#10;    &gt;&#10;    &lt;path&#10;        android:fillColor=&quot;#00000000&quot;&#10;        android:pathData=&quot;M12,3L12,21&quot;&#10;        android:strokeWidth=&quot;2&quot;&#10;        android:strokeColor=&quot;#FEFEFE&quot;&#10;        /&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;#00000000&quot;&#10;        android:pathData=&quot;M3,12L21,12&quot;&#10;        android:strokeWidth=&quot;2&quot;&#10;        android:strokeColor=&quot;#FEFEFE&quot;&#10;        /&gt;&#10;&lt;/vector&gt;&#10;" />
              <option name="updatedContent" value="&lt;vector xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:width=&quot;24dp&quot;&#10;    android:height=&quot;24dp&quot;&#10;    android:viewportWidth=&quot;24&quot;&#10;    android:viewportHeight=&quot;24&quot;&#10;    &gt;&#10;    &lt;path&#10;        android:fillColor=&quot;#00000000&quot;&#10;        android:pathData=&quot;M12,3L12,21&quot;&#10;        android:strokeWidth=&quot;2&quot;&#10;        android:strokeColor=&quot;#FEFEFE&quot;&#10;        android:strokeLineCap=&quot;round&quot;&#10;        /&gt;&#10;    &lt;path&#10;        android:fillColor=&quot;#00000000&quot;&#10;        android:pathData=&quot;M3,12L21,12&quot;&#10;        android:strokeWidth=&quot;2&quot;&#10;        android:strokeColor=&quot;#FEFEFE&quot;&#10;        android:strokeLineCap=&quot;round&quot;&#10;        /&gt;&#10;&lt;/vector&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>